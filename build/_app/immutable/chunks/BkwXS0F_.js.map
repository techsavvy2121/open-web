{"version":3,"file":"BkwXS0F_.js","sources":["../../../../../../src/lib/apis/users/index.ts"],"sourcesContent":["import { WEBUI_API_BASE_URL } from '$lib/constants';\nimport { getUserPosition } from '$lib/utils';\n\nexport const getUserGroups = async (token: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/groups`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getUserDefaultPermissions = async (token: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/default/permissions`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const updateUserDefaultPermissions = async (token: string, permissions: object) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/default/permissions`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\t...permissions\n\t\t})\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const updateUserRole = async (token: string, id: string, role: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/update/role`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\tid: id,\n\t\t\trole: role\n\t\t})\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getUsers = async (\n\ttoken: string,\n\tquery?: string,\n\torderBy?: string,\n\tdirection?: string,\n\tpage = 1\n) => {\n\tlet error = null;\n\tlet res = null;\n\n\tlet searchParams = new URLSearchParams();\n\n\tsearchParams.set('page', `${page}`);\n\n\tif (query) {\n\t\tsearchParams.set('query', query);\n\t}\n\n\tif (orderBy) {\n\t\tsearchParams.set('order_by', orderBy);\n\t}\n\n\tif (direction) {\n\t\tsearchParams.set('direction', direction);\n\t}\n\n\tres = await fetch(`${WEBUI_API_BASE_URL}/users/?${searchParams.toString()}`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getAllUsers = async (token: string) => {\n\tlet error = null;\n\tlet res = null;\n\n\tres = await fetch(`${WEBUI_API_BASE_URL}/users/all`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getUserSettings = async (token: string) => {\n\tlet error = null;\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/user/settings`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const updateUserSettings = async (token: string, settings: object) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/user/settings/update`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\t...settings\n\t\t})\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getUserById = async (token: string, userId: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/${userId}`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getUserInfo = async (token: string) => {\n\tlet error = null;\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/user/info`, {\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const updateUserInfo = async (token: string, info: object) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/user/info/update`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\t...info\n\t\t})\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\nexport const getAndUpdateUserLocation = async (token: string) => {\n\tconst location = await getUserPosition().catch((err) => {\n\t\tconsole.error(err);\n\t\treturn null;\n\t});\n\n\tif (location) {\n\t\tawait updateUserInfo(token, { location: location });\n\t\treturn location;\n\t} else {\n\t\tconsole.info('Failed to get user location');\n\t\treturn null;\n\t}\n};\n\nexport const deleteUserById = async (token: string, userId: string) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/${userId}`, {\n\t\tmethod: 'DELETE',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t}\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n\ntype UserUpdateForm = {\n\tprofile_image_url: string;\n\temail: string;\n\tname: string;\n\tpassword: string;\n};\n\nexport const updateUserById = async (token: string, userId: string, user: UserUpdateForm) => {\n\tlet error = null;\n\n\tconst res = await fetch(`${WEBUI_API_BASE_URL}/users/${userId}/update`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\tAuthorization: `Bearer ${token}`\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\tprofile_image_url: user.profile_image_url,\n\t\t\temail: user.email,\n\t\t\tname: user.name,\n\t\t\tpassword: user.password !== '' ? user.password : undefined\n\t\t})\n\t})\n\t\t.then(async (res) => {\n\t\t\tif (!res.ok) throw await res.json();\n\t\t\treturn res.json();\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\terror = err.detail;\n\t\t\treturn null;\n\t\t});\n\n\tif (error) {\n\t\tthrow error;\n\t}\n\n\treturn res;\n};\n"],"names":["getUserDefaultPermissions","token","error","res","WEBUI_API_BASE_URL","err","updateUserDefaultPermissions","permissions","updateUserRole","id","role","getUsers","query","orderBy","direction","page","searchParams","getAllUsers","getUserSettings","updateUserSettings","settings","getUserById","userId","updateUserInfo","info","getAndUpdateUserLocation","location","getUserPosition","deleteUserById","updateUserById","user"],"mappings":"oEA8Ba,MAAAA,EAA4B,MAAOC,GAAkB,CACjE,IAAIC,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,6BAA8B,CAC1E,OAAQ,MACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUH,CAAK,EAC/B,CAAA,CACA,EACC,KAAK,MAAOE,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR,EAEaG,EAA+B,MAAOL,EAAeM,IAAwB,CACzF,IAAIL,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,6BAA8B,CAC1E,OAAQ,OACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUH,CAAK,EAC/B,EACA,KAAM,KAAK,UAAU,CACpB,GAAGM,CAAA,CACH,CAAA,CACD,EACC,KAAK,MAAOJ,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR,EAEaK,EAAiB,MAAOP,EAAeQ,EAAYC,IAAiB,CAChF,IAAIR,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,qBAAsB,CAClE,OAAQ,OACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUH,CAAK,EAC/B,EACA,KAAM,KAAK,UAAU,CACpB,GAAAQ,EACA,KAAAC,CAAA,CACA,CAAA,CACD,EACC,KAAK,MAAOP,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR,EAEaQ,EAAW,MACvBV,EACAW,EACAC,EACAC,EACAC,EAAO,IACH,CACJ,IAAIb,EAAQ,KACRC,EAAM,KAENa,EAAe,IAAI,gBAiCvB,GA/BAA,EAAa,IAAI,OAAQ,GAAGD,CAAI,EAAE,EAE9BH,GACUI,EAAA,IAAI,QAASJ,CAAK,EAG5BC,GACUG,EAAA,IAAI,WAAYH,CAAO,EAGjCC,GACUE,EAAA,IAAI,YAAaF,CAAS,EAGlCX,EAAA,MAAM,MAAM,GAAGC,CAAkB,WAAWY,EAAa,SAAU,CAAA,GAAI,CAC5E,OAAQ,MACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUf,CAAK,EAC/B,CAAA,CACA,EACC,KAAK,MAAOE,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEEH,EACG,MAAAA,EAGA,OAAAC,CACR,EAEac,EAAc,MAAOhB,GAAkB,CACnD,IAAIC,EAAQ,KACRC,EAAM,KAmBV,GAjBAA,EAAM,MAAM,MAAM,GAAGC,CAAkB,aAAc,CACpD,OAAQ,MACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUH,CAAK,EAC/B,CAAA,CACA,EACC,KAAK,MAAOE,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEEH,EACG,MAAAA,EAGA,OAAAC,CACR,EAEae,EAAkB,MAAOjB,GAAkB,CACvD,IAAIC,EAAQ,KACZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,uBAAwB,CACpE,OAAQ,MACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUH,CAAK,EAC/B,CAAA,CACA,EACC,KAAK,MAAOE,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR,EAEagB,EAAqB,MAAOlB,EAAemB,IAAqB,CAC5E,IAAIlB,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,8BAA+B,CAC3E,OAAQ,OACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUH,CAAK,EAC/B,EACA,KAAM,KAAK,UAAU,CACpB,GAAGmB,CAAA,CACH,CAAA,CACD,EACC,KAAK,MAAOjB,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR,EAEakB,EAAc,MAAOpB,EAAeqB,IAAmB,CACnE,IAAIpB,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,UAAUkB,CAAM,GAAI,CAChE,OAAQ,MACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUrB,CAAK,EAC/B,CAAA,CACA,EACC,KAAK,MAAOE,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR,EA4BaoB,EAAiB,MAAOtB,EAAeuB,IAAiB,CACpE,IAAItB,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,0BAA2B,CACvE,OAAQ,OACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUH,CAAK,EAC/B,EACA,KAAM,KAAK,UAAU,CACpB,GAAGuB,CAAA,CACH,CAAA,CACD,EACC,KAAK,MAAOrB,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR,EAEasB,EAA2B,MAAOxB,GAAkB,CAChE,MAAMyB,EAAW,MAAMC,EAAkB,EAAA,MAAOtB,IAC/C,QAAQ,MAAMA,CAAG,EACV,KACP,EAED,OAAIqB,GACH,MAAMH,EAAetB,EAAO,CAAE,SAAAyB,CAAoB,CAAA,EAC3CA,IAEP,QAAQ,KAAK,6BAA6B,EACnC,KAET,EAEaE,EAAiB,MAAO3B,EAAeqB,IAAmB,CACtE,IAAIpB,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,UAAUkB,CAAM,GAAI,CAChE,OAAQ,SACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUrB,CAAK,EAC/B,CAAA,CACA,EACC,KAAK,MAAOE,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR,EASa0B,EAAiB,MAAO5B,EAAeqB,EAAgBQ,IAAyB,CAC5F,IAAI5B,EAAQ,KAEZ,MAAMC,EAAM,MAAM,MAAM,GAAGC,CAAkB,UAAUkB,CAAM,UAAW,CACvE,OAAQ,OACR,QAAS,CACR,eAAgB,mBAChB,cAAe,UAAUrB,CAAK,EAC/B,EACA,KAAM,KAAK,UAAU,CACpB,kBAAmB6B,EAAK,kBACxB,MAAOA,EAAK,MACZ,KAAMA,EAAK,KACX,SAAUA,EAAK,WAAa,GAAKA,EAAK,SAAW,MAAA,CACjD,CAAA,CACD,EACC,KAAK,MAAO3B,GAAQ,CACpB,GAAI,CAACA,EAAI,GAAU,MAAA,MAAMA,EAAI,KAAK,EAClC,OAAOA,EAAI,MAAK,CAChB,EACA,MAAOE,IACP,QAAQ,MAAMA,CAAG,EACjBH,EAAQG,EAAI,OACL,KACP,EAEF,GAAIH,EACG,MAAAA,EAGA,OAAAC,CACR"}